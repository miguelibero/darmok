syntax = "proto3";

package darmok.protobuf;

import "varying.proto";
import "shape.proto";
import "program.proto";
import "math.proto";

message CubeMeshSource {
    Cube shape = 1;
    Mesh.RectangleType type = 2;
}

message SphereMeshSource {
    Sphere shape = 1;
    uint32 lod = 2;
}

message CapsuleMeshSource {
    Capsule shape = 1;
    uint32 lod = 2;
}

message RectangleMeshSource {
    Rectangle shape = 1;
    Mesh.RectangleType type = 2;
}

message ConeMeshSource {
    Cone shape = 1;
    uint32 lod = 2;
}

message CylinderMeshSource {
    Cylinder shape = 1;
    uint32 lod = 2;
}

message DataMeshSource {
    message Vertex {
        Vec3 position = 1;
        Vec2 tex_coord = 2;
        Vec3 normal = 3;
        Vec3 tangent = 4;
        Color color = 5;
    }

    message Bone {
        message Weight {
            uint32 vertex_id = 1;
            float value = 2;
        }
        string name = 1;
        repeated Weight weights = 2;
    }

    repeated Vertex vertices = 1;
    repeated uint32 indices = 2;
    repeated Bone bones = 3;
    bool has_tangents = 5;
}

message MeshSource {
    string name = 1;
    Mesh.Type type = 2;
    bool index32 = 3;
    ProgramRef program = 4;
    oneof value {
        DataMeshSource data = 5;
        CubeMeshSource cube = 6;
        SphereMeshSource sphere = 7;
        CapsuleMeshSource capsule = 8;
        RectangleMeshSource rectangle = 9;
        ConeMeshSource cone = 10;
        CylinderMeshSource cylinder = 11;
    }
}

message Mesh {
    enum Type {
        Static = 0;
        Dynamic = 1;
        Transient = 2;
    }

    enum RectangleType {
        FullRectangle = 0;
        OutlineRectangle = 1;
    }

    enum LineType {
        Line = 0;
        Bone = 1;
        Arrow = 2;
    }

    string name = 1;
    Mesh.Type type = 2;
    bool index32 = 3;
    VertexLayout layout = 4;
    bytes vertices = 5;
    bytes indices = 6;
    BoundingBox bounds = 7;
}